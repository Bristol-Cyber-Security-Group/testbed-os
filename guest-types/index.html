<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guest Types &mdash; testbed-os 1.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=fc837d61"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TestbedOS Server" href="../testbedos-server/index.html" />
    <link rel="prev" title="GUI Architecture" href="../interfaces/gui/architecture.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            testbed-os
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Testbed OS Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testbed-config/index.html">Testbed Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kvm-compose/index.html">kvm-compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/index.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guest Types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#libvirt">Libvirt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#android-virtual-device">Android Virtual Device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testbedos-server/index.html">TestbedOS Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource-monitoring/index.html">Resource Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test-harness/index.html">Test Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">testbed-os</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Guest Types</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guest-types/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="guest-types">
<h1>Guest Types<a class="headerlink" href="#guest-types" title="Link to this heading"></a></h1>
<p>The testbed supports three main types of guests in the yaml file:</p>
<ul class="simple">
<li><p>Libvirt virtual machines</p></li>
<li><p>Docker containers</p></li>
<li><p>Android Virtual Devices (AVD)</p></li>
</ul>
<p>These guests can all be defined and assigned to the testbed network.
While they all support being deployed in the testbed, only the cloud-init based Libvirt guests support automation at this time.</p>
<p>We have introduced Docker and AVD as guests to remove the need to deploy these inside a Libvirt virtual machine.
This removes the overhead of a whole virtual machine in terms of performance and disk usage.
However, if the use case requires it or there is some functionality that is not supported in our implementation, you are free to deploy Docker and AVD instances inside Libvirt virtual machines.</p>
<p>The following subsections describe further the capabilities of the guest types, implementation details and limitations.</p>
<section id="libvirt">
<h2>Libvirt<a class="headerlink" href="#libvirt" title="Link to this heading"></a></h2>
<p>The Libvirt virtual machines are split into three sub-types based on their mode of installation:</p>
<ul class="simple">
<li><p>cloud image (using cloud-init)</p></li>
<li><p>existing disk (bring a preconfigured image)</p></li>
<li><p>iso guest (bring an installation .iso image)</p></li>
</ul>
<p>The cloud image based guests will have full automation capabilities offered by the testbed, due to the ability to seed the deployment using cloud-init.
We are able to customise the deployment using the cloud-init functionality.
Additionally, this allows us to insert SSH keys to be able to remotely control the guest and customise further and run scripts etc.</p>
<p>Both existing disk and iso guests are limited to just being able to be started in the testbed and in the network, but will require manual intervention to set up.
For example, if the user sets up the SSH keys in an existing disk guest before deploying in the testbed then they will be able to control this guest remotely.
However, such guests may only be running a webserver for experimentation in the testbed for example that is preconfigured so needing to set up SSH keys may not be necessary as it is ready to be used.
Note that the user may need to configure networking such as enabling DHCP or manually assigning an IP address, this is done automatically for you if using cloud image guest type.</p>
<p>Depending on how the guest is configured, if getty is enabled inside the guest you will be able to make a TCP TTY based connection directly to the guest.
See in the state.json file after you have executed <cite>generate-artefacts</cite> to see the port number for this TTY.
You will need to log in to the guest using the username and password.</p>
</section>
<section id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Link to this heading"></a></h2>
<p>The docker guests have little configuration needed, the testbed will provision the required networking for the running container.
Note that since the container is assigned to the testbed network, the networking works slightly differently to how you expect if you were using just docker or docker-compose.
We utilise <cite>ovs-docker</cite> to assign the container to the specified OVS bridge, which creates an interface <cite>eth0</cite> in the container and assigns an IP address.</p>
<p>You can use the various built in Docker commands in the CLI to inspect or control the container.
Make sure you use the name of the container the testbed assigns, which will be <cite>&lt;project name&gt;-&lt;machine name&gt;</cite>.
For example, if the project is called <cite>analysis</cite> and the docker machine name in the yaml file is called <cite>webserver</cite>, then the container name will be <cite>analysis-webserver</cite>.
If you have used scaling in the machine definition, you will need to append the id of the scaled container.
For example, if you have scaling set to 3 (where the ids start at 0) and you want to run a docker command on the second id (1) then you would use <cite>analysis-webserver-1</cite> as the container name.</p>
</section>
<section id="android-virtual-device">
<h2>Android Virtual Device<a class="headerlink" href="#android-virtual-device" title="Link to this heading"></a></h2>
<p>The AVD guests can either be created and deployed on demand or you are able to bring a pre-configured image to the testbed.</p>
<p>The AVD emulator has some peculiarities in how it provisions networking for the emulated device, see <a class="reference external" href="https://developer.android.com/studio/run/emulator-networking">https://developer.android.com/studio/run/emulator-networking</a>
Specifically how it binds the networking to the localhost, it required some isolation to be able to integrate the emulator inside the testbed network.
This means we deploy the emulator inside a network namespace, which is connected to the designated testbed network bridge through veths.
Currently, the emulator can act as a client to the other guests in the network i.e. the applications in the emulator can make requests to web servers on other (non-AVD) guests in the testbed network.
However, we currently don’t support the emulator acting as a server to other guests - this may be supported in the future.
You may have some success by utilising ADB to enable port forwards to the device or by editing the deploy script and adding Qemu options.</p>
<p>It is possible to utilise ADB to control the android guest remotely, however note that due to the emulator being in the namespace as mentioned above, the ADB server will also run inside the namespace and accept connections through the namespace’s localhost.
This only means any ADB commands must be executed using the namespace command, for example:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ip</span> <span class="pre">netns</span> <span class="pre">exec</span> <span class="pre">android-test</span> <span class="pre">adb</span> <span class="pre">-s</span> <span class="pre">emulator-5554</span> <span class="pre">shell</span></code></p>
<p>where <cite>android-test</cite> is the namespace name.</p>
<p>However you can also use the built in <cite>exec</cite> commands to run commands via ADB but note that since the command runs from the testbed server, you cannot open a shell to the guest - only one time commands.</p>
<p>Additionally, due to how we deploy and control guests through the TestbedOS server, the AVD configuration will be under the root user.
This is a critical detail to allow the ADB connection to authenticate using the key that is found in the <cite>$USER</cite> directory, which in this case will be under root.
If the emulator is not under the root user, say you are bringing in a pre-configured emulator you may need to use the command as following:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-E</span> <span class="pre">bash</span> <span class="pre">-c</span>&#160; <span class="pre">'ip</span> <span class="pre">netns</span> <span class="pre">exec</span> <span class="pre">android-test</span> <span class="pre">adb</span> <span class="pre">-s</span> <span class="pre">emulator-5554</span> <span class="pre">shell'</span> <span class="pre">$USER</span></code></p>
<p>where <cite>$USER</cite> can be left as is, if the emulator is under your user account or replace it with the user’s account.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../interfaces/gui/architecture.html" class="btn btn-neutral float-left" title="GUI Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../testbedos-server/index.html" class="btn btn-neutral float-right" title="TestbedOS Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Bristol Cyber Security Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>